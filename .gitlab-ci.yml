image: debian:stable-slim

before_script:
  - apt-get -y update && cd content/
  - if grep -r Fluid || grep -r Fluidsignal\ Group || grep -r fluidsignal; then echo "El Ãºnico nombre aceptado es FLUID"; exit 1; fi
  - cd ../ && apt-get install -y python-pip libssl-dev libcurl4-openssl-dev ruby ruby-dev asciidoc source-highlight
  - pip install -r requirements.txt
  - gem install sass

deployment:
  environment: production	
  script:
    - pip install awscli
    - pelican --fatal errors content/
    - aws s3 cp --recursive --acl=public-read-write output/ s3://blog.fluid.la
  only:
     - master

pages:
  environment: staging
  script:
    - sed -i 's/https:\/\/fluid.la\/site/\/blog/' pelicanconf.py
    - pelican --fatal errors content/
    - mkdir -p /public
    - cp -r output/ public/
  artifacts:
    paths:
      - public/
  except:
    - master
