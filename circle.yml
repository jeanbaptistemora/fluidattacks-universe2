#
# Archivo de configuracion del servicio de integración continua.
#

machine:
  pre:
# Este parche se requiere para que docker soporte especificación de IPs
    - curl -sSL https://s3.amazonaws.com/circle-downloads/install-circleci-docker.sh | bash -s -- 1.10.0
  timezone: America/Bogota
  services:
    - docker
# version de python del sistema base de CI, se requiere por ansible-container.
  python:
    version: 2.7.10


dependencies:
  pre:
    - sudo apt-get update
    - sudo pip install --upgrade pip setuptools
  override:
    - sudo apt-get install ansible curl
  post:
    - ansible --version
    - container/build.sh
    - container/start.sh
    - docker ps
    - container/smoke.sh

# Antes de este punto todo es cacheable.  Pendiente investigar como.

test:
  pre:
    - ansible container -i provision/hosts -m ping
