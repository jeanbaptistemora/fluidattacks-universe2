:slug: defends/csharp/esquema-autorizacion/
:category: csharp
:description: Nuestros ethical hackers explican cómo evitar vulnerabilidades de seguridad mediante la programación segura en C Sharp al implementar esquemas de autorización. El manejo adecuado de esquemas de autorización mediante roles en una aplicación reduce el riesgo de que se presenten eventos de seguridad.
:keywords: C Sharp, Seguridad, Esquema, Autorización, Roles, AzMan
:defends: yes

= Implementar esquema de autorización

== Necesidad

Implementar esquemas de autorización declarativos

== Contexto

A continuación se describe las circunstancias
bajo las cuales la siguiente solución tiene sentido:

. Se está desarrollando una aplicación en +C#+
en sistemas operativos +Windows server 2003+ o superiores.

== Solución

El +Authorization Manager+ de +Microsoft+ es una herramienta flexible,
escalable y de fácil administración para establecer seguridad basada en roles.
El +Autorization Manager+ es comúnmente conocido como +AzMan+.
Se puede usar en cualquier aplicación
que quiera usar autorización declarativa basada en roles.

Todos los permisos creados en +AzMan+
son almacenados en contenedores de información
que pueden ser archivos +XML+ o Directorio activo.

De manera detallada, se debe proceder del siguiente modo:

. Abrir el menú de Windows ir a ejecutar y escribir +AzMan.msc+.
+
.Interfaz de AzMan
image::azman-1.png[Interfaz de Azman]

. En el menú de acciones seleccionar +options+,
en el dialogo se debe escoger +Developer mode+.
+
.Habilitando el modo desarrollador
image::azman-2.png[Habilitando el modo desarrollador]

. Se debe seleccionar el menú de acción
y luego hacer clic en +New Authorization Store+.
El usuario obtendrá la opción de crear +XML+ o un directorio activo.
Seleccionar la ubicación para el archivo +XML+
e ingresar las descripciones requeridas.
+
.Contenedores de Autorización
image::azman-3.png[Creando un nuevo contenedor de autorización]

. En el menú de acciones, seleccionar la opción +New Application+
y establecer un nombre de aplicación y una version.
+
.Creando una nueva aplicación
image::azman-4.png[Creando un nuevo contenedor de autorización]

. Expandir la aplicación y seleccionar la definición de operaciones
bajo la categoría definiciones.
Seleccione el menú de acción o ubique el cursor en el panel derecho
y haga clic derecho para obtener el menú contextual
y seleccione la opción crear +New Operation Definition+.
Asegúrese de dar números únicos a las operaciones creadas.
+
.Definición de operaciones
image::azman-5.png[Definición de operaciones]

. Ahora seleccione las definiciones de tareas,
escoja +New Task+ bajo el menú de acción
o ubique el cursor en el panel derecho,
haga clic derecho para obtener el menú contextual
y seleccione la opción +New Operation Definition+.
Cada tarea tendrá una o más operaciones asociadas.
Las tareas también pueden contener otras tareas.
Utilice nombres únicos para las tareas.
+
.Definición de Tareas
image::azman-6.png[Definición de tareas]

. Ahora seleccione las definiciones de roles bajo la categoría de definiciones,
cree un nuevo rol con descripciones para cada uno y asigne tareas.
+
.Asignación de Tareas
image::azman-7.png[Asignación de tareas]

. Hasta este punto se ha definido roles comunes y las tareas para cada rol.
Ahora se debe asignar únicamente los roles
que son adecuados para la aplicación que se ha creado.
Es probable que no todos los roles sean adecuados para la aplicación.
Seleccione en la categoría +Role Assignment+ bajo la carpeta de la aplicación
y luego escoja en la opción de menú +Action->Add Role+;
de la lista, seleccione aquellos que sean adecuados.
+
.Asignación de Roles
image::azman-8.png[Asignación de Roles]

. Se ha definido las operaciones, tareas y roles.
Se ha asignado los respectivos roles a la aplicación.
Ahora se debe asignar los usuarios de Windows
y crear los grupos para los roles definidos.
Seleccione la carpeta grupos bajo la aplicación
y seleccione con el clic derecho
para escoger la opción crear nuevo grupo de aplicación.
Nombre el grupo de aplicación con una descripción.
Ahora haga clic derecho en el grupo de aplicación creado
y seleccione propiedades. En la ventana de propiedades,
seleccione la pestaña miembros y de clic en la opción
de adicionar usuarios de Windows y grupos,
adicione todos los usuarios que son parte de los grupos.
+
.Adición de usuarios
image::azman-9.png[Adición de usuarios]

. Una vez que se han definido todos los detalles
de la seguridad basada en roles,
es necesario enlazar los roles con los grupos de la aplicación.
De este modo, será posible encontrar el rol
y los permisos de operación para un usuario autenticado en el sistema.
Seleccione el rol y el permiso de operación
para el usuario que se autentica al sistema.
Seleccione el rol que se asigna a la aplicación.
Ahora haga clic derecho en el rol
y seleccione la opción para asignar a los grupos de la aplicación.
+
.Enlace de grupos a la aplicación
image::azman-10.png[Enlace de grupos a la aplicación]

. Una vez que se ha terminado de definir
la seguridad basada en roles para la aplicación
se debe crear el alcance, de ser requerido.
El alcance significa agrupar las definiciones anteriores,
de manera que cuando un usuario se autentique
se puedan determinar los permisos para un alcance
y redireccionar el flujo de la aplicación según sea conveniente.
+
.Creación de alcance
image::azman-11.png[creación de alcance]

. Una vez que se tiene la seguridad basada en roles en el +AzMan+,
se puede usar en aplicaciones.
Cree una aplicación en +C#+.
Adicione una referencia a +Microsoft.Interop.Secuirty.AzRoles.dll+.
Esta tiene los +API+ para acceder el +AzMan+ y a sus permisos.
