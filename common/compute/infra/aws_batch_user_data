Content-Type: multipart/mixed; boundary="==BOUNDARY=="
MIME-Version: 1.0

--==BOUNDARY==
Content-Type: text/cloud-config; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: attachment; filename="cloud-config.txt"

#cloud-config
repo_update: true
repo_upgrade: all

packages:
 - rsync

disk_setup:
  /dev/nvme1n1:
    table_type: mbr
    layout: true
    overwrite: true

fs_setup:
  - label: nvme
    filesystem: ext4
    device: /dev/nvme1n1
    partition: auto
    overwrite: true

mounts:
  - [/dev/nvme1n1, /mnt/docker]

write_files:
- content: |
    {"data-root": "/mnt/docker/", "storage-driver": "overlay" }
  path: /etc/docker/daemon.json

runcmd:
 - [ rsync, -avPHSX, /var/lib/docker/, /mnt/docker/ ]
 - [ service, docker, restart ]

--==BOUNDARY==
Content-Type: text/x-shellscript; charset="us-ascii"

#!/bin/bash
# Set any ECS agent configuration options
{
  echo ECS_CONTAINER_START_TIMEOUT=1h
  echo ECS_CONTAINER_STOP_TIMEOUT=120s
  echo ECS_ENABLE_SPOT_INSTANCE_DRAINING=true
  echo ECS_ENGINE_TASK_CLEANUP_WAIT_DURATION=5m
  echo ECS_ENABLE_UNTRACKED_IMAGE_CLEANUP=true
  echo ECS_IMAGE_CLEANUP_INTERVAL=11m
  echo ECS_IMAGE_MINIMUM_CLEANUP_AGE=1s
  echo ECS_IMAGE_PULL_BEHAVIOR=always
  echo ECS_IMAGE_PULL_INACTIVITY_TIMEOUT=1h
  echo ECS_NUM_IMAGES_DELETE_PER_CYCLE=10000
  echo NON_ECS_IMAGE_MINIMUM_CLEANUP_AGE=1s
  echo ECS_ENABLE_TASK_IAM_ROLE_NETWORK_HOST=true

}  >> /etc/ecs/ecs.config

--==BOUNDARY==--
