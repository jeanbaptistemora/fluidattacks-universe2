.makes: &makes
  tags: [autoscaling]
  image: "${CI_REGISTRY_IMAGE}/makes"
  interruptible: true
  script:
    - ./m "${CI_JOB_NAME% *}"
  variables:
    GIT_DEPTH: 5

.commit_pattern: &commit_pattern '$CI_COMMIT_TITLE =~ /^(all|observes)/'

.dev_job: &dev_job
  rules:
    - if: '$CI_COMMIT_BRANCH == "master"'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "merge_request_event"'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "schedule"'
      when: never
    - if: '$CI_PIPELINE_SOURCE == "trigger"'
      when: never
    - if: *commit_pattern
      changes:
        - observes/singer/tap_csv/**/*
        - observes/common/**/*

.lint_job: &lint_job
  <<: *makes
  <<: *dev_job
  needs: []
  stage: lint-code

.test_job: &test_job
  <<: *makes
  <<: *dev_job
  stage: test-code

observes.lint.tap-csv:
  <<: *lint_job

observes.test.tap-csv:
  <<: *test_job
