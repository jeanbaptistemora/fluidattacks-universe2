/deployContainerImage/forcesDev:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs: []
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
      when: never
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: never
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: never
    - if: $CI_PIPELINE_SOURCE == "trigger"
      when: never
    - if: $CI_COMMIT_TITLE =~ /^(all|forces)/
  script:
    - m . /deployContainerImage/forcesDev
  stage: build
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
/deployContainerImage/forcesProd:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs: []
  rules:
    - if: $CI_COMMIT_BRANCH != "master"
      when: never
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: never
    - if: $CI_PIPELINE_SOURCE == "trigger"
      when: never
    - if: $CI_COMMIT_TITLE =~ /^(all|forces)/
  script:
    - m . /deployContainerImage/forcesProd
  stage: deploy-app
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
/deployTerraform/forces:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs: []
  resource_group: $CI_JOB_NAME
  rules:
    - if: $CI_COMMIT_BRANCH != "master"
      when: never
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: never
    - if: $CI_PIPELINE_SOURCE == "trigger"
      when: never
    - if: $CI_COMMIT_TITLE =~ /^(all|forces)/
  script:
    - m . /deployTerraform/forces
  stage: deploy-infra
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
/forces/process-groups:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs: []
  only:
    refs:
      - schedules
    variables:
      - $forces_process_groups
  script:
    - m . /forces/process-groups
  stage: scheduler
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
/forces/process-groups-break:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs: []
  only:
    refs:
      - schedules
    variables:
      - $forces_process_groups_break
  script:
    - m . /forces/process-groups-break
  stage: scheduler
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
/forces/test:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs:
    - /integrates/back/deploy/dev
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
      when: never
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: never
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: never
    - if: $CI_PIPELINE_SOURCE == "trigger"
      when: never
    - if: $CI_COMMIT_TITLE =~ /^(all|forces)/
  script:
    - m . /forces/test
  stage: post-deploy
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
/lintPython/module/forces:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs: []
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
      when: never
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: never
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: never
    - if: $CI_PIPELINE_SOURCE == "trigger"
      when: never
    - if: $CI_COMMIT_TITLE =~ /^(all|forces)/
  script:
    - m . /lintPython/module/forces
  stage: lint-code
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
/lintPython/module/forcesTests:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs: []
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
      when: never
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: never
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: never
    - if: $CI_PIPELINE_SOURCE == "trigger"
      when: never
    - if: $CI_COMMIT_TITLE =~ /^(all|forces)/
  script:
    - m . /lintPython/module/forcesTests
  stage: lint-code
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
/lintTerraform/forces:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs: []
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
      when: never
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: never
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: never
    - if: $CI_PIPELINE_SOURCE == "trigger"
      when: never
    - if: $CI_COMMIT_TITLE =~ /^(all|forces)/
  script:
    - m . /lintTerraform/forces
  stage: lint-code
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
/pipelineOnGitlab/forces:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs: []
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
      when: never
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: never
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: never
    - if: $CI_PIPELINE_SOURCE == "trigger"
      when: never
    - if: $CI_COMMIT_TITLE =~ /^(all|forces)/
  script:
    - m . /pipelineOnGitlab/forces
  stage: lint-code
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
/testTerraform/forces:
  image: ghcr.io/fluidattacks/makes:21.12
  interruptible: true
  needs: []
  rules:
    - if: $CI_COMMIT_BRANCH == "master"
      when: never
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: never
    - if: $CI_PIPELINE_SOURCE == "schedule"
      when: never
    - if: $CI_PIPELINE_SOURCE == "trigger"
      when: never
    - if: $CI_COMMIT_TITLE =~ /^(all|forces)/
  script:
    - m . /testTerraform/forces
  stage: test-infra
  tags:
    - autoscaling
  variables:
    GIT_DEPTH: 1
    MAKES_GIT_DEPTH: 1
