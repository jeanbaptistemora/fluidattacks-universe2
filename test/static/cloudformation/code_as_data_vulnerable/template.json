{
  "Description": "code_as_data_vulnerable",
  "Parameters": {
    "DiskEncryption": {
      "Default": false,
      "Type": "String"
    },
    "IpInsecureProtocol": {
      "Default": "-1",
      "Description": "Insecure ip protocol",
      "Type": "String"
    },
    "IpSecurityGroup": {
      "Default": "12.34.12.43/16",
      "Description": "Ip of SecurityGroup",
      "Type": "String"
    }
  },
  "Resources": {
    "ec2instance1": {
      "Properties": {
        "DisableApiTermination": "false"
      },
      "Type": "AWS::EC2::Instance"
    },
    "securityGroup1": {
      "Properties": {
        "GroupDescription": "groupDescription1",
        "SecurityGroupIngress": [
          {
            "CidrIp": "0.0.0.0/0",
            "FromPort": 1,
            "IpProtocol": "-1",
            "ToPort": 65535
          },
          {
            "CidrIp": {
              "Ref": "IpSecurityGroup"
            },
            "FromPort": 1,
            "IpProtocol": "-1",
            "ToPort": 65535
          },
          {
            "CidrIpv6": "::/0",
            "FromPort": 1,
            "IpProtocol": {
              "Ref": "IpInsecureProtocol"
            },
            "ToPort": 65535
          }
        ]
      },
      "Type": "AWS::EC2::SecurityGroup"
    },
    "securityGroup2": {
      "Properties": {
        "GroupDescription": "groupDescription2"
      },
      "Type": "AWS::EC2::SecurityGroup"
    },
    "securityGroupEgress1": {
      "Properties": {
        "CidrIp": "34.229.161.227/16",
        "FromPort": 22,
        "GroupId": {
          "Ref": "securityGroup2"
        },
        "IpProtocol": "-1",
        "ToPort": 8080
      },
      "Type": "AWS::EC2::SecurityGroupEgress"
    },
    "securityGroupIngress1": {
      "Properties": {
        "CidrIp": "110.229.161.227/16",
        "FromPort": 22,
        "GroupName": "securityGroup2",
        "IpProtocol": {
          "Ref": "IpInsecureProtocol"
        },
        "ToPort": 8080
      },
      "Type": "AWS::EC2::SecurityGroupIngress"
    },
    "securityGroupIngress2": {
      "Properties": {
        "CidrIp": {
          "Ref": "IpSecurityGroup"
        },
        "FromPort": 22,
        "GroupName": "securityGroup2",
        "IpProtocol": "-1",
        "ToPort": 8080
      },
      "Type": "AWS::EC2::SecurityGroupIngress"
    },
    "volume1": {
      "Properties": {
        "AvailabilityZone": {
          "Ref": "AWS::Region"
        },
        "Encrypted": "false",
        "Size": 120,
        "VolumeType": "gp2"
      },
      "Type": "AWS::EC2::Volume"
    },
    "volume2": {
      "Properties": {
        "AvailabilityZone": {
          "Ref": "AWS::Region"
        },
        "Encrypted": {
          "Ref": "DiskEncryption"
        },
        "Size": 120,
        "VolumeType": "gp2"
      },
      "Type": "AWS::EC2::Volume"
    }
  }
}