build_asserts:
  <<: *with_nix
  <<: *in_dev_branch
  artifacts:
    paths: [asserts-release/]
  stage: test

test_output_asserts:
  <<: *with_nix
  <<: *in_dev_branch
  stage: test

release_to_pypi:
  <<: *with_nix
  <<: *in_prod_branch
  stage: release_to_pypi

release_to_docker_hub:
  <<: *with_nix
  <<: *in_prod_branch
  needs: [release_to_pypi]
  stage: release_to_docker

pages:
  <<: *with_nix
  <<: *in_prod_branch
  stage: deploy
  artifacts:
    paths: [public/]
