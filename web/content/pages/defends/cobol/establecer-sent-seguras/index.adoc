:slug: defends/cobol/establecer-sent-seguras/
:category: cobol
:description: Nuestros ethical hackers explican como evitar vulnerabilidades de seguridad  mediante la programacion segura en COBOL al utilizar sentencias SQL dinámicas. Al utilizar bases de datos es importante definir privilegios estáticos, para evitar que los mismos usuarios puedan escalar privilegios.
:keywords: COBOL, Sentencias Dinámicas, SQL, Base de Datos, Procesador, Procedimientos Almacenados.
:defends: yes

= Establecer Seguridad en Sentencias Dinámicas

== Necesidad

Seguridad de las sentencias +SQL+ dinámicas para +z/OS+ y +OS/400+.

== Contexto

A continuación se describe las circunstancias
bajo las cuales la siguiente solución tiene sentido:

. Se está desarrollando una aplicación
en el sistema operativo +z/OS+ o +OS/400+.
. La aplicación hace uso de sentencias dinámicas.
. Los privilegios para objetos nuevos
deben establecerse según el principio de mínimo privilegio (+umask+)<<r1,^[1]^>>.
. Los privilegios para un sujeto
no pueden ser aumentados por el mismo sujeto<<r2,^[2]^>>.
. Los privilegios para objetos con contenido o funcionalidad sensible
deben tener acceso restringido<<r3,^[3]^>>.

== Solución

A continuación podrá encontrar un resumen
sobre la seguridad de las aplicaciones
en el momento de usar sentencias SQL dinámicas<<r4,^[4]^>>.
Por lo tanto, se toma en cuenta los siguientes supuestos:

* La aplicación no hace llamado a procedimientos almacenados<<r5,^[5]^>>
o funciones definidas por el usuario.

* El usuario final está conectado directamente a la base de datos
para ejecutar el programa de procesador de +SQL+.

* El procesador de +SQL+ está implementado de forma tal
que permite ejecutar sentencias de forma libre sin ningún tipo de control.

.Seguridad de las aplicaciones al usar sentencias +SQL+ dinámicas.
[cols=5,options="header"]
|====
|¿El procesador de +SQL+ permite ejecución libre de +SQL+?
|¿El usuario tiene la autorización de +DB2+ para acceder a los objetos?
|Opción de enlace +DYNAMICRULES+
|Implicación de seguridad
|Análisis

.2+|Sí
.2+|Sí
.2+|Run
|Dentro del procesador +SQL:+ Acceso a objetos autorizados
y ejecución de cualquier sentencia +SQL+.
.2+|Acceso desde fuera del procesador +SQL+ es un agujero de seguridad.


|Fuera del procesador +SQL:+ Acceso a objetos autorizados
y ejecución de cualquier sentencia +SQL+.

.2+|Sí
.2+|Sí
.2+|Bind
|Dentro del procesador +SQL:+ Acceso a objetos autorizados
para el propietario del enlace
y ejecución de cualquier sentencia +SQL+.
.2+|* El acceso desde dentro del procesador +SQL+
es probablemente muy permisivo
debido a que el propietario del enlace
suele tener todos los accesos inclusivos.

* Acceso desde fuera del procesador +SQL+ es un agujero de seguridad.

|Fuera del procesador +SQL:+ Acceso a objetos autorizados
y ejecución de cualquier sentencia +SQL+.

|Sí
|No
|Run
|No hay acceso desde dentro o fuera del procesador +SQL+.
|Sin sentido

.2+|Sí
.2+|No
.2+|Bind
|Dentro del procesador +SQL:+ Acceso a objetos autorizados
para el propietario del enlace y ejecución de cualquier sentencia +SQL+.
.2+|* El acceso desde dentro del procesador +SQL+
es probablemente muy permisivo
debido a que el propietario del enlace
suele tener todos los accesos inclusivos.

* Sin acceso desde fuera del procesador +SQL+.

|Fuera del procesador +SQL:+ Sin acceso.

.2+|No
.2+|Sí
.2+|Run
|Dentro del procesador +SQL:+ Acceso a objetos autorizados
y sentencia +SQL+ controlada por el procesador +SQL+.
.2+|Acceso desde fuera del procesador +SQL+
es un agujero de seguridad.

|Fuera del procesador +SQL:+ Acceso a objetos autorizados
y ejecución de cualquier sentencia +SQL+.

.2+|No
.2+|Sí
.2+|Bind
|Dentro del procesador +SQL:+ Acceso a objetos autorizados
para el propietario del enlace
y sentencia +SQL+ controlada por el procesador +SQL+.
.2+|Acceso desde fuera del procesador +SQL+
es un agujero de seguridad.


|Fuera del procesador +SQL:+ Acceso a objetos autorizados
y ejecución de cualquier sentencia +SQL+.

|No
|No
|Run
|No hay acceso desde dentro o fuera del procesador +SQL+.
|Sin sentido.

.2+|No
.2+|No
.2+|Bind
|Dentro del procesador +SQL:+ Acceso a objetos autorizados
para el propietario del enlace
y sentencia +SQL+ controlada por el procesador +SQL+.
.2+|Configuración más segura.

|Fuera del procesador +SQL:+ Sin acceso.

|====

== Referencias

. [[r1]] link:../../../rules/269/[REQ.269 Usar principio mínimo privilegio].
. [[r2]] link:../../../rules/035/[REQ.035 Administrar modificaciones de privilegios].
. [[r3]] link:../../../rules/176/[REQ.176 Restringir objetos del sistema].
. [[r4]] link:http://www.redbooks.ibm.com/abstracts/sg246418.html[DB2 for z/OS and OS/390 : Squeezing the Most Out of Dynamic SQL].
. [[r5]] link:https://www.ibm.com/developerworks/rational/cafe/attachments/2914-3-1908/sg247604.pdf[DB2 9 for z/OS Stored Procedures: Through the CALL and Beyond].
