[tox]
minversion = 3.14.0
envlist = py37
isolated_build = true

[testenv]
setenv =
    LOGGER_DEBUG=true
    LOGGER_INFO=true
    LOGGER_WARN=true
passenv = *
deps =
    pytest==5.1.2
    pytest-cov==2.7.1
    pytest-xdist==1.29.0
    pytest-random-order==1.0.4
    ../break-build/packages/utilities
    fluidasserts
commands =
    sh -c 'pushd .. && fluid resources --clone continuoustest && popd'
    pytest

[testenv:lint]
commands =
    prospector --profile ../break-build/config/prospector/code.yml .
    mypy --ignore-missing-imports toolbox

[testenv:deploy]
recreate = true
passenv = *
deps =
    twine==2.0.0
changedir =
    {toxworkdir}
commands =
    sh -c '../deploy.sh'
whitelist_externals =
    sh

[pytest]
addopts=
    # pytest
    --verbose
    --exitfirst
    --color=yes
    --capture=fd
    --durations=0
    --failed-first
    --disable-warnings
    # pytest-cov
    --cov=toolbox
    --cov-branch
    --cov-report term
    --cov-report html:.coverage-html
    --no-cov-on-fail
    # pytest-xdist
    --numprocesses=auto
    # pytest-random-order
    --random-order
testpaths=
    tests
