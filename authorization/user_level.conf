[request_definition]
r = subject, object, action

[policy_definition]
p = level, subject, object, role

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m =  (p.level == 'user') \
  && (r.subject == p.subject) \
  && (r.object == p.object) \
  && ( \
       (p.role == 'admin' \
         && (r.action == 'backend_api_query_Query_resolve_internal_project_names' \
              || r.action == 'backend_entity_cache_InvalidateCache_mutate' \
              || r.action == 'backend_entity_project_CreateProject_mutate' \
              || r.action == 'backend_entity_user_AddUser_mutate')) \
    || (p.role == 'analyst' \
         && (r.action == 'backend_entity_cache_InvalidateCache_mutate')) \
    || (p.role == 'customer' \
         && regexMatch(p.subject, '.*@fluidattacks.com$') \
         && (r.action == 'backend_entity_project_CreateProject_mutate')) \
  )
