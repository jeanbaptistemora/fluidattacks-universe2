[request_definition]
r = subject, object, action

[policy_definition]
p = level, subject, object, role

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m =  (p.level == 'user') \
  && (r.subject == p.subject) \
  && (r.object == p.object) \
  && ( \
       (p.role == 'admin' \
         && (r.action == 'backend_api_resolvers_cache_resolve_invalidate_cache' \
              || r.action == 'backend_api_resolvers_internal_project_resolve_project_name' \
              || r.action == 'backend_api_resolvers_project_resolve_create_project' \
              || r.action == 'backend_api_resolvers_user_resolve_add_user' \
              || r.action == 'backend_api_resolvers_subscription__do_post_broadcast_message' \
              || r.action == 'backend_api_resolvers_project_resolve_alive_projects')) \
    || (regexMatch(p.role, '^(admin|customeradmin)$') \
         && (r.action == 'backend_api_resolvers_me__get_tags' \
          || r.action == 'backend_api_resolvers_user_resolve_user_list_projects' \
          || r.action == 'backend_api_resolvers_tag_resolve_tag')) \
    || (p.role == 'analyst' \
         && (r.action == 'backend_api_resolvers_cache_resolve_invalidate_cache')) \
    || (p.role == 'customer' \
         && regexMatch(p.subject, '.*@fluidattacks.com$') \
         && (r.action == 'backend_api_resolvers_project_resolve_create_project' \
          || r.action == 'backend_api_resolvers_user_resolve_user_list_projects')) \
  )
