[request_definition]
r = subject, object, action

[policy_definition]
p = level, subject, object, role

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m =  (r.subject == p.subject) \
  && (  (p.level == 'user' && p.role == 'admin') \
     || (p.level == 'group' && r.object == p.object)) \
  && ( \
    (regexMatch(p.role, '^(admin|analyst|customer|customeradmin)$') \
    && (r.action == 'backend_api_resolvers_resource_resolve_resources' \
     || r.action == 'backend_api_resolvers_alert_resolve_alert' \
     || r.action == 'backend_api_resolvers_forces_resolve_forces_executions' \
     || r.action == 'backend_api_resolvers_project_resolve_project' \
     || r.action == 'backend_api_resolvers_finding_resolve_finding' \
     || r.action == 'backend_api_resolvers_event_resolve_event' \
     || r.action == 'backend_api_resolvers_event_resolve_events' \
     || r.action == 'backend_api_resolvers_event__do_add_event_comment' \
     || r.action == 'backend_api_resolvers_event__do_download_event_file' \
     || r.action == 'backend_api_resolvers_resource_resolve_download_file' \
     || r.action == 'backend_api_resolvers_finding_resolve_add_finding_comment' \
     || r.action == 'backend_api_resolvers_project__get_comments' \
     || r.action == 'backend_api_resolvers_project__get_events' \
     || r.action == 'backend_api_resolvers_project_resolve_add_project_comment')) \
 || (regexMatch(p.role, '^(admin|analyst)$') \
    && (r.action == 'backend_api_resolvers_vulnerability_resolve_delete_vulnerability' \
     || r.action == 'backend_api_resolvers_vulnerability_resolve_upload_file' \
     || r.action == 'backend_api_resolvers_vulnerability_resolve_approve_vulnerability' \
     || r.action == 'backend_api_resolvers_vulnerability_resolve_vulnerability_resolve_last_analyst' \
     || r.action == 'backend_api_resolvers_vulnerability_resolve_vulnerability_resolve_analyst' \
     || r.action == 'backend_api_resolvers_event__do_create_event' \
     || r.action == 'backend_api_resolvers_event__do_update_event' \
     || r.action == 'backend_api_resolvers_event__do_solve_event' \
     || r.action == 'backend_api_resolvers_event__do_update_event_evidence' \
     || r.action == 'backend_api_resolvers_event__do_remove_event_evidence' \
     || r.action == 'backend_api_dataloaders_finding__get_historic_state' \
     || r.action == 'backend_api_dataloaders_finding__get_observations' \
     || r.action == 'backend_api_dataloaders_finding__get_analyst' \
     || r.action == 'backend_api_resolvers_finding__do_remove_evidence' \
     || r.action == 'backend_api_resolvers_finding__do_update_evidence' \
     || r.action == 'backend_api_resolvers_finding__do_update_evidence_description' \
     || r.action == 'backend_api_resolvers_finding__do_update_severity' \
     || r.action == 'backend_api_resolvers_finding__do_verify_finding' \
     || r.action == 'backend_api_resolvers_vulnerability_resolve_verify_request_vuln' \
     || r.action == 'backend_api_resolvers_finding__do_update_description' \
     || r.action == 'backend_api_resolvers_finding__do_reject_draft' \
     || r.action == 'backend_api_resolvers_finding__do_delete_finding' \
     || r.action == 'backend_api_resolvers_finding__do_create_draft' \
     || r.action == 'backend_api_resolvers_finding__do_submit_draft' \
     || r.action == 'backend_api_resolvers_project__get_drafts')) \
 || (regexMatch(p.role, '^(admin|customer|customeradmin)$') \
    && (r.action == 'backend_api_resolvers_resource_resolve_add_resources' \
     || r.action == 'backend_api_resolvers_resource_resolve_add_environments' \
     || r.action == 'backend_api_resolvers_resource_resolve_add_repositories' \
     || r.action == 'backend_api_resolvers_resource_resolve_update_resources' \
     || r.action == 'backend_api_resolvers_resource_resolve_update_environment' \
     || r.action == 'backend_api_resolvers_resource_resolve_update_repository' \
     || r.action == 'backend_api_resolvers_resource_resolve_add_files' \
     || r.action == 'backend_api_resolvers_resource_resolve_remove_files' \
     || r.action == 'backend_api_resolvers_vulnerability_resolve_delete_tags' \
     || r.action == 'backend_api_resolvers_vulnerability_resolve_update_treatment_vuln' \
     || r.action == 'backend_api_resolvers_vulnerability_resolve_request_verification_vuln' \
     || r.action == 'backend_api_resolvers_finding__do_update_client_description' \
     || r.action == 'backend_api_resolvers_project_resolve_remove_tag' \
     || r.action == 'backend_api_resolvers_project_resolve_add_tags')) \
 || (regexMatch(p.role, '^(admin|customeradmin)$') \
    && (r.action == 'backend_api_resolvers_user_resolve_user' \
     || r.action == 'backend_api_resolvers_user_resolve_grant_user_access' \
     || r.action == 'backend_api_resolvers_user_resolve_remove_user_access' \
     || r.action == 'backend_api_resolvers_user_resolve_edit_user' \
     || r.action == 'backend_api_resolvers_finding__do_handle_acceptation' \
     || r.action == 'backend_api_resolvers_project__get_users' \
     || r.action == 'backend_api_resolvers_project_resolve_request_remove_project' \
     || r.action == 'backend_api_resolvers_project_resolve_reject_remove_project')) \
 || (regexMatch(p.role, '^(customer|customeradmin)$') \
    && regexMatch(r.subject, '.*@fluidattacks.com$') \
    && (r.action == 'backend_api_resolvers_user_resolve_user_list_projects' \
     || r.action == 'backend_api_resolvers_alert_resolve_set_alert' \
     || r.action == 'backend_api_resolvers_event__do_create_event' \
     || r.action == 'backend_api_resolvers_user_resolve_user_resolve_list_projects')) \
 || (p.role == 'admin' \
    && (r.action == 'backend_api_resolvers_project_resolve_alive_projects' \
     || r.action == 'backend_api_resolvers_user_resolve_user_list_projects' \
     || r.action == 'backend_api_resolvers_user_resolve_user' \
     || r.action == 'backend_api_resolvers_event__do_create_event' \
     || r.action == 'backend_api_resolvers_finding__do_create_draft' \
     || r.action == 'backend_api_resolvers_finding__do_approve_draft' \
     || r.action == 'backend_api_resolvers_project_resolve_add_all_project_access' \
     || r.action == 'backend_api_resolvers_project_resolve_remove_all_project_access'\
     || r.action == 'backend_api_resolvers_project__get_users' \
     || r.action == 'backend_api_resolvers_project_resolve_request_remove_project' \
     || r.action == 'backend_api_resolvers_project_resolve_reject_remove_project' \
     || r.action == 'backend_api_resolvers_alert_resolve_set_alert' \
     || r.action == 'backend_api_resolvers_user_resolve_user_resolve_list_projects' \
     || r.action == 'backend_api_resolvers_user_resolve_grant_user_access' \
     || r.action == 'backend_api_resolvers_user_resolve_remove_user_access' \
     || r.action == 'backend_api_resolvers_user_resolve_edit_user' \
     || r.action == 'backend_api_resolvers_finding__do_handle_acceptation')) \
  )
