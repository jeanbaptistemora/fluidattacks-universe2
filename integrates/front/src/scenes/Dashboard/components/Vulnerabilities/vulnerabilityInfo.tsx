import _ from "lodash";
import React from "react";
import type { StyledComponent } from "styled-components";
import styled from "styled-components";

import type { IHeaderConfig } from "components/DataTableNext/types";
import { PointStatus } from "scenes/Dashboard/components/Vulnerabilities/Formatter/index";
import type { IVulnRowAttr } from "scenes/Dashboard/components/Vulnerabilities/types";
import { Row, RowCenter } from "styles/styledComponents";
import { translate } from "utils/translations/translate";

const Field: StyledComponent<"p", Record<string, unknown>> = styled.p.attrs({
  className: "f5 mb2 pr2 ws-pre-wrap ww-break-word",
})``;

const Col20: StyledComponent<
  "div",
  Record<string, unknown>
> = styled.div.attrs<{
  className: string;
}>({
  className: "w-20-l w-25-m w-50 w-50-ns",
})``;

export const vulnerabilityInfo: (
  value: string,
  row: Readonly<IVulnRowAttr>,
  rowIndex: number,
  key: Readonly<IHeaderConfig>
) => JSX.Element = (
  _value: string,
  row: Readonly<IVulnRowAttr>,
  _rowIndex: number,
  _key: Readonly<IHeaderConfig>
): JSX.Element => {
  const maxSizeWhere: number = 64;

  return (
    <React.StrictMode>
      <Row>
        <div className={"ph2-l ph0-m w-80-l w-80-m w-100 w-100-ns"}>
          <Field>
            <b>{translate.t("searchFindings.tabVuln.vulnTable.where")}</b>
            &nbsp;
            {row.where.length > maxSizeWhere ? (
              <span>
                {row.where.slice(0, maxSizeWhere)}
                {translate.t("searchFindings.tabVuln.vulnTable.more")}
              </span>
            ) : (
              row.where
            )}
          </Field>
        </div>
        <div className={"w-20-l w-20-m w-100 w-100-ns"}>
          <Field>
            <b>{translate.t("searchFindings.tabVuln.vulnTable.specific")}</b>
            &nbsp;{row.specific}
          </Field>
        </div>
      </Row>
      <div className={"flex flex-wrap items-center"}>
        <Col20>
          <RowCenter>
            <div>
              <b className={"dib v-btm"}>
                {translate.t("searchFindings.tabVuln.vulnTable.status")}
              </b>
              <p className={"dib v-btm ma0"}>
                <PointStatus status={row.currentState} />
              </p>
            </div>
          </RowCenter>
        </Col20>
        <Col20>
          {_.isEmpty(row.reportDate) ? undefined : (
            <RowCenter>
              <b className={"dib v-btm"}>
                {translate.t("searchFindings.tabVuln.vulnTable.report")}
              </b>
              <p className={"dib v-btm ma0"}>{row.reportDate}</p>
            </RowCenter>
          )}
        </Col20>
        <Col20>
          <div className={"flex flex-wrap items-center justify-start"}>
            {_.isEmpty(row.verification) ? undefined : (
              <React.Fragment>
                <div className={"w-10"} />
                <div>
                  <b className={"dib v-btm"}>
                    {translate.t("searchFindings.tabVuln.vulnTable.reattack")}
                  </b>
                  <p className={"dib v-btm ma0"}>
                    <PointStatus status={row.verification as string} />
                  </p>
                </div>
              </React.Fragment>
            )}
          </div>
        </Col20>
        <Col20>
          <div>
            <b className={"dib v-btm"}>{row.treatment}</b>
          </div>
        </Col20>
        <Col20>{row.tag}</Col20>
      </div>
    </React.StrictMode>
  );
};
