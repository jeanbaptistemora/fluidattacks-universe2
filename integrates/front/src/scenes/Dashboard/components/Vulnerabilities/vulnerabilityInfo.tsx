import type { IHeaderConfig } from "components/DataTableNext/types";
import type { IVulnRowAttr } from "scenes/Dashboard/components/Vulnerabilities/types";
import { PointStatus } from "scenes/Dashboard/components/Vulnerabilities/Formatter/index";
import React from "react";
import type { StyledComponent } from "styled-components";
import _ from "lodash";
import styled from "styled-components";
import { translate } from "utils/translations/translate";
import { Col25, Col80, Row, RowCenter } from "styles/styledComponents";

const Field: StyledComponent<"p", Record<string, unknown>> = styled.p.attrs({
  className: "f5 pr2 w-fit-content ws-pre-wrap ww-break-word",
})``;

const Col30: StyledComponent<
  "div",
  Record<string, unknown>
> = styled.div.attrs<{
  className: string;
}>({
  className: "ph1-5 w-30-ns",
})``;

const Col20: StyledComponent<
  "div",
  Record<string, unknown>
> = styled.div.attrs<{
  className: string;
}>({
  className: "w-20-ns",
})``;

export const vulnerabilityInfo: (
  value: string,
  row: Readonly<IVulnRowAttr>,
  rowIndex: number,
  key: Readonly<IHeaderConfig>
) => JSX.Element = (
  _value: string,
  row: Readonly<IVulnRowAttr>,
  _rowIndex: number,
  _key: Readonly<IHeaderConfig>
): JSX.Element => {
  const maxSizeWhere: number = 64;

  return (
    <React.StrictMode>
      <Row>
        <Col80>
          <Field>
            <b>{translate.t("searchFindings.tabVuln.vulnTable.where")}</b>
            &nbsp;
            {row.where.length > maxSizeWhere ? (
              <span>
                {row.where.slice(0, maxSizeWhere)}
                {translate.t("searchFindings.tabVuln.vulnTable.more")}
              </span>
            ) : (
              row.where
            )}
          </Field>
        </Col80>
        <Col20>
          <Field>
            <b>{translate.t("searchFindings.tabVuln.vulnTable.specific")}</b>
            &nbsp;{row.specific}
          </Field>
        </Col20>
      </Row>
      <Row>
        <Col25>
          <RowCenter>
            <b>{translate.t("searchFindings.tabVuln.vulnTable.status")}</b>
            <PointStatus status={row.currentState} />
          </RowCenter>
        </Col25>
        <Col30>
          <RowCenter>
            {_.isEmpty(row.verification) ? undefined : (
              <React.Fragment>
                <b>
                  {translate.t("searchFindings.tabVuln.vulnTable.reattack")}
                </b>
                <PointStatus status={row.verification} />
              </React.Fragment>
            )}
          </RowCenter>
        </Col30>
        <Col25>
          <b>{row.treatment}</b>
        </Col25>
        <Col20>{row.tag}</Col20>
      </Row>
    </React.StrictMode>
  );
};
