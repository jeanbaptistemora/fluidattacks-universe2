from typing import Dict, List, cast

from backend.typing import (
    Finding as FindingType,
    Historic as HistoricType
)


def filter_open_vulns(
    vulnerabilities: List[Dict[str, FindingType]],
) -> List[Dict[str, FindingType]]:
    open_vulns = [
        vuln
        for vuln in vulnerabilities
        if cast(
            HistoricType,
            vuln.get('historic_state', [{}])
        )[-1].get('state') == 'open'
    ]

    return open_vulns
