schema;vulnerability_attributes:
  type: map
  mapping: &vulnerability_attributes
    source:
      # default in the backend: integrates
      type: str
      enum: ['integrates', 'skims']
      required: false
    state:
      type: str
      enum: ['open', 'closed']
      required: true

type: map
mapping:
  inputs:
    type: seq
    sequence:
      - type: map
        mapping:
          stream:
            type: str
            pattern: ^(\b[\w-]{1,30}\b)+(,\b[\w-]{1,30}\b){0,9}$
            required: true
          field:
            type: str
            required: true
          url:
            type: str
            required: true
          <<: *vulnerability_attributes
  lines:
    type: seq
    sequence:
      - type: map
        mapping:
          commit_hash:
            pattern: ^([a-f0-9]{40})$
            required: true
            type: str
          line:
            type: str
            pattern: ^[0-9]+(?:-[0-9]+)?(,[0-9]+(?:-[0-9]+)?)*$
            required: true
          path:
            type: str
            pattern: ^(?!=)+([^/][^/]+/([^/]+/?)+)|([^\\]+\\([^\\]+\\?)+)|^([^/]+)$
            required: true
          <<: *vulnerability_attributes
  ports:
    type: seq
    sequence:
      - type: map
        mapping:
          host:
            type: str
            required: true
          port:
            type: str
            pattern: ^[0-9]+(?:-[0-9]+)?(,[0-9]+(?:-[0-9]+)?)*$
            required: true
          <<: *vulnerability_attributes
