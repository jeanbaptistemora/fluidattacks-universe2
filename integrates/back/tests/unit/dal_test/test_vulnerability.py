import os
import pytest
from starlette.datastructures import (
    UploadFile,
)
from vulnerabilities.dal import (
    upload_file,
)

pytestmark = [
    pytest.mark.asyncio,
]


async def test_upload_file() -> None:
    filename = os.path.dirname(os.path.abspath(__file__))
    filename = os.path.join(filename, "../mock/test-vulns.yaml")
    with open(filename, "rb") as btest_file:
        test_file = UploadFile(filename=btest_file.name)
        await test_file.write(btest_file.read())
        await test_file.seek(0)
        assert await upload_file(test_file) == "test-vulns.yaml"
