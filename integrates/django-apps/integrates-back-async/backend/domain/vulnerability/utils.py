# Local
from backend import authz
from backend.exceptions import (
    InvalidTreatmentManager,
)


async def validate_treatment_manager(
    *,
    treatment_manager: str,
    is_customer_admin: bool,
    user_email: str,
    group_name: str,
) -> str:
    if not is_customer_admin:
        treatment_manager = user_email
    enforcer = await authz.get_group_level_enforcer(treatment_manager)

    if not enforcer(group_name, 'valid_treatment_manager'):
        raise InvalidTreatmentManager()

    return treatment_manager
